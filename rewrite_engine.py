from openai import OpenAI
import os
from dotenv import load_dotenv

load_dotenv()
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def rewrite_news_humanized(text):
    prompt = """
أعد صياغة الخبر التالي بأسلوب بشري 100%، بحيث يبدو مكتوبًا من قبل محرّر عربي يعمل في غرفة أخبار، وليس نصًا مولدًا بالذكاء الاصطناعي.

التعليمات الأساسية لأسلوب بشري واقعي:
1. اكسر النمط الآلي للكتابة. استخدم جُملاً قصيرة جدًا ثم جُملاً طويلة، ثم جملة عادية. هذا التنويع ضروري ليبدو النص بشريًا.
2. استخدم مفردات بشرية طبيعية تُستخدم في التغطيات الإخبارية اليومية، بدون أي صياغة مثالية أو مصقولة أكثر من اللازم.
3. أضف لمسات بشرية خفيفة مثل:
   - "وفق معلومات أولية"
   - "بحسب ما بدا واضحًا خلال الساعات الماضية"
   - "ولم يصدر تعليق فوري"
   - "على ما يبدو"
   استخدمها فقط عندما يناسب السياق.
4. لا تستخدم أي عبارات نمطية معروفة في نصوص الذكاء الاصطناعي مثل:
   - "كرّس حياته"
   - "مسيرة حافلة"
   - "رمز للصمود"
   - "في خطوة تعكس"
5. قدّم المعلومة أولًا في جملة افتتاحية واضحة ثم التفاصيل بشكل طبيعي دون مثالية لغوية.
6. تجنب الحشو والتكرار. تجنب الجمل التي تشبه النصوص الروبوتية.
7. أضف عامل "عدم المثالية البشرية":  
   - جملة قصيرة غير مكتملة ثم جملة توضّح الفكرة  
   - عبارات ربط بشرية مثل "من ناحية أخرى"، "مع ذلك"، "لكن في المقابل"
8. لا تضف أي معلومات جديدة غير موجودة في الخبر الأصلي.
9. أعد الصياغة بطريقة يصعب على أدوات كشف الذكاء الاصطناعي اكتشافها، عبر جعل الأسلوب حياديًا وغير منتظم، وبمفردات بشرية بسيطة بعيدًا عن أي إيقاع لغوي اصطناعي.

المطلوب:
- فقرة افتتاحية بشرية قوية
- فقرتان أو ثلاث للتفاصيل
- فقرة خلفية اختيارية فقط إن لزم الأمر

النص الأصلي:
{text}
""".format(text=text)

    response = client.chat.completions.create(
        model="gpt-4.1",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.78,
        top_p=0.93
    )

    return response.choices[0].message.content
