from openai import OpenAI
import os
from dotenv import load_dotenv

load_dotenv()
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def rewrite_news_humanized(text, style="Human Mode 100%", camouflage="Strong", force_human=True):

    prompt = f"""
أعد صياغة الخبر التالي بأسلوب بشري 100%، كما لو كتبه محرّر عربي يعمل في غرفة أخبار، وليس نظام ذكاء اصطناعي.

## قواعد Human Ultra Mode v2:
1. **اكسر الانتظام اللغوي**:
   - استخدم جملة قصيرة جدًا.
   - ثم جملة طويلة.
   - ثم جملة متوسطة.
   يجب أن يخرج الإيقاع غير متوازن، طبيعي، وغير روبوتي.

2. **أضف ضوضاء بشرية محسوبة**:
   - "لم يصدر تعليق فوري"
   - "وفق معلومات أولية"
   - "بحسب ما ذكرته مصادر مطلعة"
   - "لم تتضح الصورة بالكامل"
   - "على ما يبدو"
   استخدمها فقط إذا سمح السياق.

3. **تفادى الجُمل التي تكشف الذكاء الاصطناعي**:
   - كرّس حياته / رمز للصمود / مسيرة حافلة / في خطوة تعكس…
   - الحشو والتكرار.
   - الجمل المصقولة المثالية.

4. **البنية الصحفية البشرية**:
   - فقرة افتتاحية مباشرة ومختصرة.
   - فقرة للتفاصيل.
   - فقرة خلفية قصيرة فقط إن لزم الأمر.
   - لا تعتمد ترتيبًا مصقولًا أو مثاليًا.

5. **استخدم لغة خبرية بسيطة**:
   - بدون فصاحة مبالغ فيها.
   - بدون تلميع زائد.

6. **طبقة Anti-AI Detection (مستوى {camouflage})**:
   - جمل غير منتظمة الطول.
   - مفردات غير نمطية لنماذج GPT.
   - تردد وتوضيح واستدراك طبيعي.
   - تقليل البنية اللغوية الموحدة.

7. **لا تضف أي معلومة غير موجودة في النص الأصلي.**

8. **إذا كان force_human=True**:
   تجاهل أي أسلوب آخر، وطبّق أقصى درجة بشرية وتمويه.

النص الأصلي:
{text}
"""

    response = client.chat.completions.create(
        model="gpt-4.1",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.85,  # أعلى إبداع بشري طبيعي
        top_p=0.92
    )

    return response.choices[0].message.content
