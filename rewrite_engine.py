from openai import OpenAI
import os
from dotenv import load_dotenv

load_dotenv()
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def rewrite_news_humanized(text):
    prompt = """
أعد صياغة الخبر التالي بأسلوب صحفي عربي بشري بالكامل، مماثل لأسلوب وكالات الأنباء مثل رويترز و«أسوشيتد برس» و«سكاي نيوز عربية».

القواعد:
1. اكتب بصياغة بشرية طبيعية، وليست روبوتية أو منظمة أكثر من اللازم.
2. استخدم جمل قصيرة، ثم جمل متوسطة، ثم جملة طويلة عندما يلزم — تنويع إيقاع الكتابة ضروري.
3. تجنب صياغات الذكاء الاصطناعي النمطية مثل: (كرّس حياته – رمز للصمود – مسيرة حافلة).
4. ابدأ بالحدث الأهم في جملة افتتاحية قوية وواضحة.
5. أعرض التفاصيل بشكل صحفي محايد دون مبالغة.
6. أضف سياقًا محدودًا فقط إن كان موجودًا في الخبر الأصلي أو مستنتجًا بوضوح.
7. يمكن إضافة لمسات بشرية خفيفة جدًا مثل:
   - "وفق معلومات أولية"
   - "بحسب ما نقلته وسائل إعلام محلية"
   - "ولم يصدر تعليق فوري"
   فقط عند اللزوم وبدون مبالغة.
8. لا تكرر أي فكرة. لا تستخدم الحشو.

المطلوب:
- فقرة افتتاحية قوية
- فقرتان أو ثلاث للتفاصيل
- فقرة خلفية اختيارية

النص الأصلي:
{text}
""".format(text=text)

    response = client.chat.completions.create(
        model="gpt-4.1",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.72,
        top_p=0.92
    )

    return response.choices[0].message.content
