from openai import OpenAI
import os
from dotenv import load_dotenv

load_dotenv()
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def rewrite_news_humanized(text, style="Human Mode 100%", camouflage="Strong", force_human=True):

    prompt = f"""
أعيد صياغة الخبر التالي بأسلوب بشري 100%، بحيث يبدو وكأنه مكتوب من قبل محرّر عربي يعمل في غرفة أخبار وليس نصًا مولدًا بالذكاء الاصطناعي.

تعليمات الأسلوب البشري الواقعي (Human Ultra Mode):
1. اكسر الانتظام: استخدم جملة قصيرة جدًا، ثم جملة طويلة، ثم جملة متوسطة. لا تجعل الإيقاع منتظمًا.
2. تجنب الأسلوب المصقول جدًا. يجب أن يكون النص طبيعيًا وليس مثاليًا.
3. استخدم مفردات بشرية واقعية مثل:
   - "على ما يبدو"
   - "وفق معلومات أولية"
   - "لم يتّضح بعد"
   - "بحسب ما ذكرته مصادر مطلعة"
4. لا تستخدم أي مفردات نمطية للذكاء الاصطناعي مثل: (كرّس حياته، رمز للصمود، مسيرة حافلة، في خطوة تعكس…).
5. قدّم المعلومة أولًا، ثم التفاصيل. ولكن ليس بصياغة منظمة بشكل روبوتي.
6. أضف ترددًا بشريًا بسيطًا: جملة تشرح، ثم جملة تخفف، ثم جملة تؤكد.
7. ممنوع اختراع أي معلومات غير موجودة في النص الأصلي.
8. نفّذ طبقة التمويه ضد أدوات كشف الذكاء الاصطناعي:
   - عدم الانتظام في صياغة الجمل
   - استخدام لغة حيادية غير مصقولة
   - إدخال ضوضاء بشرية محسوبة بدون مبالغة
   - عدم تكرار الجمل أو إنتاج نص خطابي
9. استخدم أسلوب الصحفيين العرب الواقعيين: لغة خبرية واضحة ولكن غير “نظيفة بالكامل”.

النص الأصلي:
{text}
"""

    response = client.chat.completions.create(
        model="gpt-4.1",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.82,
        top_p=0.92
    )

    return response.choices[0].message.content
